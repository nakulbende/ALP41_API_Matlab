
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>API for controlling DMD</title><meta name="generator" content="MATLAB 8.3"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2016-02-09"><meta name="DC.source" content="API.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>API for controlling DMD</h1><!--introduction--><p>This API controls Digital Micromirror Devices (DMD) device controlled by ViALUX ALP controller. The library is provided by ViALUX GmbH, which is loaded into the environment. Since the library is in C++, there needs to be a working C++ compiler installed and setup with MATLAB. Compatible compilers could be found at <a href="http://www.mathworks.com/support/compilers/R2014b/index.html">http://www.mathworks.com/support/compilers/R2014b/index.html</a> (careful about the version).</p><p>Necessary documentation and libraries can be found in accompanying media (CDs, Drives etc,) from ViALUX. Read about the original VIALUX API in documentation.</p><div><ul><li>This API was developed with grateful aid from Dr. Martin Vogel (Max Planck Institute of Biophysics) and VIALUX. This is a simpler subset of the ALP Tool provided by Dr. Vogel. (<a href="http://www.mathworks.com/matlabcentral/fileexchange/46673-alptool">http://www.mathworks.com/matlabcentral/fileexchange/46673-alptool</a>)</li></ul></div><div><ul><li>Get ALP drivers at (<a href="http://www.vialux.de/transfer/alp-4.2/ALP42_install.exe">http://www.vialux.de/transfer/alp-4.2/ALP42_install.exe</a> OR <a href="http://www.vialux.de/transfer/alp-4.1/ALP41_install.exe">http://www.vialux.de/transfer/alp-4.1/ALP41_install.exe</a>)</li></ul></div><div><ul><li>Careful about the versions of library you load - x64/ x86. This API is for basic - not high speed.</li></ul></div><div><ul><li>Comments/ correspondence should be addressed to <b>nakulbende [at] gmail [dot] com</b></li></ul></div><div><ul><li>Following functions can be used. An exmaple code with a typical routine is included as <b><i>api_control.m</i></b>. This code contains all the functions to be used, in the right order to load library, connect the mirrors and load images.</li></ul></div><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Load libraries in MATLAB <i>(api_library)</i></a></li><li><a href="#3">Connect/ Allocate a DMD device <i>(api_allocate)</i></a></li><li><a href="#6">Inquire device/ controller parameters <i>(api_inquire)</i></a></li><li><a href="#9">Reset the DMD device <i>(api_reset)</i></a></li><li><a href="#12">Clear the DMD mirrors <i>(api_clear)</i></a></li><li><a href="#15">Load image on the mirrors <i>(api_load)</i></a></li><li><a href="#18">Free the DMD Device after use <i>(api_free)</i></a></li><li><a href="#21">Return: Success / error reporting <i>(return_check)</i></a></li></ul></div><h2>Load libraries in MATLAB <i>(api_library)</i><a name="1"></a></h2><p><b>Loads a shared library and it's functions in MATLAB environment.</b></p><p><b>INPUTS:</b> (both without file extensions)</p><p><i>dll_name</i> = name of the dll file</p><p><i>dll_header</i> = name of the header file</p><p><b>OUTPUTS:</b></p><p><i>return_lib</i> = 'Library is loaded'; or 'Error: Library was not loaded'</p><p><i>(Opens a list of functions available in library in a seperate window)</i></p><p><img vspace="5" hspace="5" src="library.png" alt=""> </p><p><b>Figure. 1 Loaded library and available functions</b></p><pre class="codeinput"><span class="keyword">function</span> [return_lib] = api_library(dll_name, dll_header)
</pre><h2>Connect/ Allocate a DMD device <i>(api_allocate)</i><a name="3"></a></h2><p><b>Connects the device with MATLAB, and generates a device handle which will be used as an address for subsequent operations</b></p><p><b>INPUTS:</b> (both without file extensions)</p><p><i>dll_name</i> = name of the dll file</p><p><b>OUTPUT:</b></p><p><i>hdevice</i> = device handle generated by allocate function</p><pre class="codeinput"><span class="keyword">function</span> [return_allocate, hdevice] = api_allocate(dll_name)
</pre><h2>Inquire device/ controller parameters <i>(api_inquire)</i><a name="6"></a></h2><p><b>Sends a query to the device, and stores the value in an out pointer. The query types can be (found in documentation):</b></p><p><img vspace="5" hspace="5" src="Inquiries.png" alt=""> </p><p><b>Table.1 Queries to be used in alp_inquiry, alp_control</b></p><p><b>INPUTS:</b></p><p><i>dll_name</i> = Loaded control library <i>hdevice</i> = device handle generated by allocate function</p><p><i>query</i> = Query type: Pg 6, returns in Pg. 7, Pg. 16, Pg. 17</p><p><b>Common query commands (Pg. 16), non-exhaustive, please refer to documentation</b></p><div><ul><li>0: Timeout</li><li>1: dll Version, driver version</li><li>2. Halt, firmware date</li><li>3. Configuration date</li><li>4. Device serial</li><li>5. DMD Type (return values in Pg 7)</li><li>6. Hardware version</li><li>7. Chipset version</li><li>8. DIP switches</li><li>9. DDC Signals</li></ul></div><p><b>OUTPUT:</b></p><p><i>return_queryptr</i> = C style pointer with the readout from device/ controlled about the specific query. Data type depends on the query, and can be found out by using the command get(<i>return_queryptr</i>)</p><pre class="codeinput"><span class="keyword">function</span> [return_inquiry, return_query] = api_inquire(dll_name, hdevice, query)
</pre><h2>Reset the DMD device <i>(api_reset)</i><a name="9"></a></h2><p><b>Reset the DMD device to load another image. <i>Should be performed before any clear function.</i> The reset operation itself takes the same time to finish, independent of how many mirrors are affected.</b></p><p><b>INPUTS:</b></p><p><i>dll_name</i> = Loaded control library <i>hdevice</i> = device handle generated by allocate function <i>reset_mode</i> = first block to be cleared Pg. 22 of API guide,</p><div><ul><li>1 : Single</li><li>2 : Pair</li><li>3 : Quad</li><li>4 : Global</li></ul></div><p><i>reset_address</i> = address of block to be reset (0 for global), see guide for others</p><p><img vspace="5" hspace="5" src="Reset.png" alt=""> </p><p><b>Table.2 Reset block assignment for different options</b></p><p><b>OUTPUT:</b></p><p><i>return_reset</i> = Return for success/ error reporting</p><pre class="codeinput"><span class="keyword">function</span> [return_reset] = api_reset(dll_name, hdevice, reset_mode, reset_address)
</pre><h2>Clear the DMD mirrors <i>(api_clear)</i><a name="12"></a></h2><p><b>The clear operation sets the memory content of whole reset blocks to logic &#8217;0&#8217;</b></p><p><b>INPUTS:</b></p><p><i>dll_name</i> = Loaded control library</p><p><i>hdevice</i> = device handle generated by allocate function</p><p><i>first_block</i> = first block to be cleared (0)</p><p><i>last_block</i> = last block to be cleared (15)</p><p>OUTPUT:</p><p><i>return_clear</i> = Return for success/ error reporting</p><pre class="codeinput"><span class="keyword">function</span> [return_clear] = api_clear(dll_name, hdevice, first_block, last_block)
</pre><h2>Load image on the mirrors <i>(api_load)</i><a name="15"></a></h2><p><b>Send an image to the mirrors, and display it. Careful about the lags, if using this in a loop. This should always be performaed in following to <i>Reset</i> &gt; <i>Clear</i> command.</b></p><p><b>INPUTS:</b></p><p><i>dll_name</i> = Loaded control library <i>hdevice</i> = device handle generated by allocate function</p><p><i>image</i> = image matrix should be in 0/1. Dimensions 768X1024 (rowsXcolumns). Note that C style structures are transpose equivalant of the MATLAB counterparts.</p><p><i>first_row</i> = first row to be loaded (0)</p><p><i>last_row</i> = last row to be loaded (767)</p><p><b>OUTPUT:</b></p><p><i>return_load</i> = Return for success/ error reporting</p><pre class="codeinput"><span class="keyword">function</span> [return_load] = api_load(dll_name, hdevice, image, first_row, last_row)
</pre><h2>Free the DMD Device after use <i>(api_free)</i><a name="18"></a></h2><p><b>Frees the device, and returns the mirrors to a floating position. !!Alwyas perform this beofre shutting off the mirrors!!</b></p><p><b>INPUTS:</b></p><p><i>dll_name</i> = Loaded control library</p><p><i>hdevice</i> = device handle generated by allocate function</p><p><b>OUTPUT:</b></p><p><i>return_free</i> = Return for success/ error reporting</p><pre class="codeinput"><span class="keyword">function</span> [return_free] = api_free(dll_name, hdevice)
</pre><h2>Return: Success / error reporting <i>(return_check)</i><a name="21"></a></h2><p><b>Check the return from other functions - Check documentation (Pg. 9)</b></p><p><b>INPUTS:</b></p><p><i>return_value</i> = Return for success/ error reporting</p><p><b>OUTPUT:</b></p><p><i>out_signal</i> = Return for success/ error reporting</p><p><img vspace="5" hspace="5" src="Returns.png" alt=""> </p><p><b>Table.3 Return codes</b></p><pre class="codeinput"><span class="keyword">function</span> [out_signal] = return_check(return_value);
</pre><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2014a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% API for controlling DMD
%
% This API controls Digital Micromirror Devices (DMD) device controlled by
% ViALUX ALP controller. The library is provided by ViALUX GmbH, which is
% loaded into the environment. Since the library is in C++, there needs to
% be a working C++ compiler installed and setup with MATLAB. Compatible
% compilers could be found at
% http://www.mathworks.com/support/compilers/R2014b/index.html (careful
% about the version).
%
% Necessary documentation and libraries can be found in accompanying media
% (CDs, Drives etc,) from ViALUX. Read about the original VIALUX API in
% documentation.
%
% * This API was developed with grateful aid from Dr. Martin Vogel (Max
% Planck Institute of Biophysics) and VIALUX. This is a simpler subset of
% the ALP Tool provided by Dr. Vogel.
% (http://www.mathworks.com/matlabcentral/fileexchange/46673-alptool)
% 
% * Get ALP drivers at
% (http://www.vialux.de/transfer/alp-4.2/ALP42_install.exe OR
% http://www.vialux.de/transfer/alp-4.1/ALP41_install.exe)
%
% * Careful about the versions of library you load - x64/ x86. This API is
% for basic - not high speed. 
% 
% * Comments/ correspondence should be addressed to *nakulbende [at] gmail
% [dot] com*
%
% * Following functions can be used. An exmaple code with a typical routine
% is included as *_api_control.m_*. This code contains all the functions to
% be used, in the right order to load library, connect the mirrors and load
% images. 
%
%% Load libraries in MATLAB _(api_library)_
%
% *Loads a shared library and it's functions in MATLAB environment.*
%
% *INPUTS:* (both without file extensions)
    %
    % _dll_name_ = name of the dll file
    %
    % _dll_header_ = name of the header file
    %
% *OUTPUTS:*
    %
    % _return_lib_ = 'Library is loaded'; or 'Error: Library was not loaded'
    %
    % _(Opens a list of functions available in library in a seperate window)_
% 
% <<library.png>>
%
% *Figure. 1 Loaded library and available functions*
function [return_lib] = api_library(dll_name, dll_header)

%% Connect/ Allocate a DMD device _(api_allocate)_
%
% *Connects the device with MATLAB, and generates a device handle which will
% be used as an address for subsequent operations*
%
% *INPUTS:* (both without file extensions)
    %
    % _dll_name_ = name of the dll file
    %
% *OUTPUT:*
    %
    % _hdevice_ = device handle generated by allocate function
function [return_allocate, hdevice] = api_allocate(dll_name)

%% Inquire device/ controller parameters _(api_inquire)_
%
% *Sends a query to the device, and stores the value in an out pointer. The
% query types can be (found in documentation):*
%
% <<Inquiries.png>>
%
% *Table.1 Queries to be used in alp_inquiry, alp_control*
%
% *INPUTS:*
    %
    % _dll_name_ = Loaded control library _hdevice_ = device handle
    % generated by allocate function
    %
    % _query_ = Query type: Pg 6, returns in Pg. 7, Pg. 16, Pg. 17
%
% *Common query commands (Pg. 16), non-exhaustive, please refer to
% documentation*
%
    % * 0: Timeout
    % * 1: dll Version, driver version
    % * 2. Halt, firmware date
    % * 3. Configuration date 
    % * 4. Device serial 
    % * 5. DMD Type (return values in Pg 7) 
    % * 6. Hardware version 
    % * 7. Chipset version 
    % * 8. DIP switches 
    % * 9. DDC Signals
%    
% *OUTPUT:*
    %
    % _return_queryptr_ = C style pointer with the readout from device/
    % controlled about the specific query. Data type depends on the query,
    % and can be found out by using the command get(_return_queryptr_)
function [return_inquiry, return_query] = api_inquire(dll_name, hdevice, query)

%% Reset the DMD device _(api_reset)_
%
% *Reset the DMD device to load another image. _Should be performed before
% any clear function._ The reset operation itself takes the same time to
% finish, independent of how many mirrors are affected.*
%
% *INPUTS:*
    %
    % _dll_name_ = Loaded control library _hdevice_ = device handle
    % generated by allocate function
    % _reset_mode_ = first block to be cleared Pg. 22 of API guide, 
    %
    % * 1 : Single
    % * 2 : Pair
    % * 3 : Quad
    % * 4 : Global
    %
    % _reset_address_ = address of block to be reset (0 for global), see
    % guide for others
    % 
    % <<Reset.png>>
    %
    % *Table.2 Reset block assignment for different options*
    %
% *OUTPUT:*
    %
    % _return_reset_ = Return for success/ error reporting
function [return_reset] = api_reset(dll_name, hdevice, reset_mode, reset_address)

%% Clear the DMD mirrors _(api_clear)_
%
% *The clear operation sets the memory content of whole reset blocks to
% logic ’0’*
%    
% *INPUTS:*
    %
    % _dll_name_ = Loaded control library 
    %
    % _hdevice_ = device handle generated by allocate function
    %
    % _first_block_ = first block to be cleared (0)
    %
    % _last_block_ = last block to be cleared (15)
    %    
% OUTPUT:
    %
    % _return_clear_ = Return for success/ error reporting
function [return_clear] = api_clear(dll_name, hdevice, first_block, last_block)

%% Load image on the mirrors _(api_load)_
%
% *Send an image to the mirrors, and display it. Careful about the lags, if
% using this in a loop. This should always be performaed in following to
% _Reset_ > _Clear_ command.*
%
% *INPUTS:*
    %
    % _dll_name_ = Loaded control library _hdevice_ = device handle
    % generated by allocate function
    %
    % _image_ = image matrix should be in 0/1. Dimensions 768X1024 
    % (rowsXcolumns). Note that C style structures are transpose equivalant 
    % of the MATLAB counterparts. 
    %
    % _first_row_ = first row to be loaded (0)
    %
    % _last_row_ = last row to be loaded (767)
    %    
% *OUTPUT:*
    %
    % _return_load_ = Return for success/ error reporting
function [return_load] = api_load(dll_name, hdevice, image, first_row, last_row)

%% Free the DMD Device after use _(api_free)_
%
% *Frees the device, and returns the mirrors to a floating position.
% !!Alwyas perform this beofre shutting off the mirrors!!*
%
% *INPUTS:*
    %
    % _dll_name_ = Loaded control library
    % 
    % _hdevice_ = device handle generated by allocate function
    %    
% *OUTPUT:*
    %
    % _return_free_ = Return for success/ error reporting
function [return_free] = api_free(dll_name, hdevice)

%% Return: Success / error reporting _(return_check)_
%
% *Check the return from other functions - Check documentation (Pg. 9)*
%
% *INPUTS:*
    %
    % _return_value_ = Return for success/ error reporting
    % 
% *OUTPUT:*
    %
    % _out_signal_ = Return for success/ error reporting
    % 
    % <<Returns.png>>
    %
    % *Table.3 Return codes*
    %
function [out_signal] = return_check(return_value);

##### SOURCE END #####
--></body></html>